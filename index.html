
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.16.2/dist/phaser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>

  <style>
  body { margin: 0px; display: flex; }
  canvas { margin: 0 auto; }
  </style>
</head>

<body>

</body>

<script>

let DEBUG = true;
let WIDTH = 400;
let HEIGHT = 300;

let config = {
    type: Phaser.AUTO,
    scale: {
      zoom: 2,
      width: WIDTH,
      height: HEIGHT,
      expandParent: true,
      mode: Phaser.Scale.ScaleModes.ENVELOP
    },
    render: {
      pixelArt: true
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    },
    physics: {
      default: 'arcade',
      arcade: {
        gravity: { x: 0, y: 0 },
        debug: DEBUG,
      },
    }
};

// Screens
const TITLE = 'title';
const STAGING = 'staging';
const FIGHT = 'fight';
const GAME_OVER = 'game_over';
const WIN = 'win';
const CREDITS = 'credits';

let game = new Phaser.Game(config);

let state = {
  screen: TITLE,
  debugText: null,
  player: null,
  cursors: null,
};

function preload ()
{
  this.load.spritesheet('dude', 'assets/dude.png', { frameWidth: 32, frameHeight: 48 });
}

function create ()
{
  if (DEBUG) {
    state.debugText = this.add.text(0, 0, '', { font: "15px monospace", fill: "#ffffff" });
  }

  state.player = this.physics.add.sprite(WIDTH/2, HEIGHT/2, 'dude');

  this.anims.create({
    key: 'left',
    frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }),
    frameRate: 10,
    repeat: -1
  });

  this.anims.create({
    key: 'stand',
    frames: [{ key: 'dude', frame: 4 }],
    frameRate: 20
  });

  this.anims.create({
    key: 'right',
    frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }),
    frameRate: 10,
    repeat: -1
  });

  state.cursors = this.input.keyboard.createCursorKeys();
}

function update ()
{
  if (DEBUG) {
    state.debugText.text = state.screen;
  }

  const updaters = {
    [TITLE]: function() {
      if (
        state.cursors.left.isDown ||
        state.cursors.right.isDown ||
        state.cursors.up.isDown ||
        state.cursors.down.isDown
      ) {
        state.screen = STAGING;
      }
    },
    [STAGING]: function () {
      move();
    },
    [FIGHT]: function () { },
    [GAME_OVER]: function () { },
    [WIN]: function () { },
    [CREDITS]: function () { },
  }

  updaters[state.screen]();
}

function move() {
  if (state.cursors.left.isDown) {
    state.player.setVelocityX(-160);
    state.player.anims.play('left', true);
  }
  else if (state.cursors.right.isDown) {
    state.player.setVelocityX(160);
    state.player.anims.play('right', true);
  } else {
    state.player.setVelocityX(0);
  }

  if (state.cursors.up.isDown) {
    state.player.setVelocityY(-160);
  }
  else if (state.cursors.down.isDown) {
    state.player.setVelocityY(160);
  }
  else {
    state.player.setVelocityY(0);
  }

  if (
    state.player.body.velocity.x === 0 &&
    state.player.body.velocity.y === 0
  ) {
    state.player.anims.play('stand', true);
  }
}

</script>

</html>

